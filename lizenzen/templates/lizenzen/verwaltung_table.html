{% extends "lizenzen/base.html" %}
{% load static %}
{% block title %}Lizenzverwaltung{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/styles_base.css' %}">
<link rel="stylesheet" href="{% static 'css/styles_verwaltung.css' %}">
{% endblock %}

{% block content %}
<div class="content-wrapper">

  <!-- Toolbar -->
  <div class="table-toolbar">
    <button class="icon-btn plus" onclick="openModal('createVerwaltungModal')" title="Neue Verwaltung anlegen">+</button>
    <a href="{% url 'verwaltung_export_xlsx' %}" class="icon-btn export-btn excel" title="Export als Excel">
      <img src="{% static 'icons/excel.svg' %}" alt="XLSX" class="icon"> XLSX
    </a>
    <a href="{% url 'verwaltung_export_pdf' %}" class="icon-btn export-btn pdf" title="Export als PDF">
      <img src="{% static 'icons/pdf.svg' %}" alt="PDF" class="icon"> PDF
    </a>
  </div>

  <table id="verwaltung-table" data-baseurl="verwaltung">
    <thead>
      <tr>
        <th>Lizenznehmer</th>
        <th>Schuleinheit</th>
        <th>Software</th>
        <th>Kostentyp</th>
        <th>Lizenz-Start</th>
        <th>Lizenz-Ende</th>
        <th>Schulklasse</th>
        <th>Anzahl Sch√ºler</th>
        <th>Weitere Lizenzen</th>
        <th class="actions"></th>
      </tr>
      <tr class="filter">
        {% for _ in "123456789" %}
          <td><input type="text" placeholder="Filter‚Ä¶"></td>
        {% endfor %}
        <td></td>
      </tr>
    </thead>
    <tbody>
      {% for v in verwaltungen %}
      <tr data-id="{{ v.id }}">
        <td>
          <span class="display">{{ v.lizenznehmer.name }}</span>
          <select class="edit" name="lizenznehmer" style="display:none;">
            {% for ln in lizenznehmer %}
              <option value="{{ ln.id }}" {% if v.lizenznehmer.id == ln.id %}selected{% endif %}>{{ ln.name }}</option>
            {% endfor %}
          </select>
        </td>
        <td><span class="display">{{ v.lizenznehmer.schuleinheit.bezeichnung|default:"‚Äì" }}</span></td>
        <td>
          <span class="display">{{ v.software.name }}</span>
          <select class="edit" name="software" style="display:none;">
            {% for s in software_list %}
              <option value="{{ s.id }}" {% if v.software.id == s.id %}selected{% endif %}>{{ s.name }}</option>
            {% endfor %}
          </select>
        </td>
        <td>
          <span class="display">{{ v.kostentyp.bezeichnung }}</span>
          <select class="edit" name="kostentyp" style="display:none;">
            {% for k in kostentypen %}
              <option value="{{ k.id }}" {% if v.kostentyp.id == k.id %}selected{% endif %}>{{ k.bezeichnung }}</option>
            {% endfor %}
          </select>
        </td>
        <td>
          <span class="display">{{ v.lizenz_start|date:"d.m.Y" }}</span>
          <input class="edit small-input" type="date" name="lizenz_start" value="{{ v.lizenz_start|date:'Y-m-d' }}" style="display:none;">
        </td>
        <td>
          <span class="display">{{ v.lizenz_ende|date:"d.m.Y" }}</span>
          <input class="edit small-input" type="date" name="lizenz_ende" value="{{ v.lizenz_ende|date:'Y-m-d' }}" style="display:none;">
        </td>
        <td>
          <span class="display">{{ v.schulklasse.name|default:"‚Äì" }}</span>
          <select class="edit" name="schulklasse" style="display:none;">
            {% for sk in schulklassen %}
              <option value="{{ sk.id }}" {% if v.schulklasse and v.schulklasse.id == sk.id %}selected{% endif %}>{{ sk.name }}</option>
            {% endfor %}
          </select>
        </td>
        <td><span class="display">{{ v.schulklasse.anzahl_schueler|default:"‚Äì" }}</span></td>
        <td>
          <span class="display">{{ v.anzahl_weitere_lizenzen }}</span>
          <input class="edit small-input" type="number" name="anzahl_weitere_lizenzen" value="{{ v.anzahl_weitere_lizenzen }}" style="display:none;">
        </td>
        <td class="actions">
          <button class="icon-btn edit-btn">‚úèÔ∏è</button>
          <button class="icon-btn save-btn" style="display:none;">üíæ</button>
          <button class="icon-btn cancel-btn" style="display:none;">‚ùå</button>
          <button class="icon-btn delete-btn">üóëÔ∏è</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Modal -->
<div id="createVerwaltungModal" class="modal">
  <div class="modal-content form-right">
    <div class="modal-header">Neue Verwaltung</div>
    <form id="createVerwaltungForm" class="create-form" method="post" action="{% url 'verwaltung_create' %}">
      {% csrf_token %}
      <table class="form-table">
        <tr><td>Lizenznehmer</td><td>{{ form.lizenznehmer }}</td></tr>
        <tr><td>Software</td><td>{{ form.software }}</td></tr>
        <tr><td>Kostentyp</td><td>{{ form.kostentyp }}</td></tr>
        <tr><td>Schulklasse</td><td>{{ form.schulklasse }}</td></tr>
        <tr><td>Startdatum</td><td><input type="date" name="lizenz_start" value="{{ today|date:'Y-m-d' }}"></td></tr>
        <tr><td>Enddatum</td><td><input type="date" name="lizenz_ende" value="{{ default_end|date:'Y-m-d' }}"></td></tr>
        <tr><td>Weitere Lizenzen</td><td><input type="number" name="anzahl_weitere_lizenzen" maxlength="4" style="width:4ch;"></td></tr>
      </table>
      <div class="modal-footer">
        <button type="button" onclick="closeModal('createVerwaltungModal')">‚ùå Abbrechen</button>
        <button type="submit">üíæ Speichern</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
